name: CI/CD Pipeline

on:
  push:
    branches:
      - main  # Solo cuando se hace push a la rama main

jobs:
  # Job para la integración continua (CI)
  test:
    runs-on: ubuntu-latest  # Usamos Ubuntu

    steps:
    - name: Checkout code
      uses: actions/checkout@v2  # Obtener código

    - name: Set up PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '7.4'

    - name: Install dependencies with Composer
      run: composer install

    - name: Run PHPUnit tests
      run: vendor/bin/phpunit --configuration phpunit.xml

    # Opcional: Validación de CSS
    - name: Install Stylelint
      run: npm install stylelint --save-dev

    - name: Run Stylelint on CSS files
      run: npx stylelint "**/*.css"

    # Opcional: Validación de HTML
    - name: Install HTMLHint
      run: npm install htmlhint --save-dev

    - name: Run HTMLHint on HTML files
      run: npx htmlhint "**/*.html"

  # Job para el despliegue continuo (CD)
  deploy:
    runs-on: ubuntu-latest
    needs: test  # Solo ejecutarse si las pruebas pasan

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2  # Obtener código

    - name: Set up SSH
      uses: webfactory/ssh-agent@v0.5.3
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

    - name: Deploy to Hostinger
      run: |
        ssh user@your-hostinger-domain 'cd /path/to/your/project && git pull origin main && ./deploy.sh'
